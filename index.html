<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Music Hub Pro</title>
    <style>
        :root { --neon: #00ff88; --dark: #0a0a0a; }
        body { background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; text-align: center; }
        .header { padding: 30px; background: #000; border-bottom: 2px solid var(--neon); position: sticky; top: 0; z-index: 100; }
        input { width: 85%; max-width: 500px; padding: 15px; border-radius: 30px; border: 1px solid #333; background: #111; color: #fff; outline: none; font-size: 16px; }
        .results { width: 95%; max-width: 700px; margin: 20px auto; padding-bottom: 180px; }
        .track { display: flex; align-items: center; background: #161616; padding: 12px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; border: 1px solid #222; transition: 0.3s; }
        .track:hover { border-color: var(--neon); background: #1a1a1a; transform: scale(1.02); }
        .track img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; background: #333; }
        .info { flex-grow: 1; text-align: left; margin-left: 15px; }
        .info b { display: block; color: var(--neon); }
        .player-bar { position: fixed; bottom: 0; width: 100%; background: #000; padding: 20px; border-top: 2px solid var(--neon); box-sizing: border-box; box-shadow: 0 -10px 30px rgba(0,0,0,0.8); }
        #status { margin-bottom: 10px; font-size: 13px; color: var(--neon); font-weight: bold; text-transform: uppercase; }
        audio { width: 100%; max-width: 600px; height: 40px; filter: invert(1) hue-rotate(85deg) brightness(1.5); }
    </style>
</head>
<body>

<div class="header">
    <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ª—é–±–æ–π –º—É–∑—ã–∫–∏ (Full)...">
</div>

<div class="results" id="res"></div>

<div class="player-bar">
    <div id="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
    <audio id="audio" controls autoplay></audio>
</div>

<script>
    // –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–Æ –°–°–´–õ–ö–£ –ò–ó GOOGLE
    const PROXY = "https://script.google.com/macros/s/AKfycbw6de1PMwI3ybomuD9QSEHuTghYT4tm_xBKnTfYY1kECjNvTVNYDh6mVd623I8LnZECCQ/exec"; 

    const input = document.getElementById('search');
    const resDiv = document.getElementById('res');
    const audio = document.getElementById('audio');
    const status = document.getElementById('status');

    input.addEventListener('keypress', (e) => { if (e.key === 'Enter') startSearch(input.value); });

    async function startSearch(q) {
        if(!q) return;
        resDiv.innerHTML = "<div style='padding:20px;'>–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã...</div>";
        try {
            // –ò—â–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Deezer (–∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è)
            const url = `https://api.deezer.com/search?q=${encodeURIComponent(q)}`;
            const r = await fetch(PROXY + "?url=" + encodeURIComponent(url));
            const d = await r.json();
            render(d.data);
        } catch (e) { status.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–æ–∫—Å–∏!"; }
    }

    function render(tracks) {
        resDiv.innerHTML = "";
        if(!tracks || tracks.length === 0) {
            resDiv.innerHTML = "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ";
            return;
        }
        tracks.forEach(t => {
            const d = document.createElement('div');
            d.className = 'track';
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞–ø—Ä—è–º—É—é, –µ—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –∏—Ö –Ω–µ –≥—Ä—É–∑–∏—Ç
            const img = t.album.cover_medium;
            d.innerHTML = `<img src="${img}"><div class="info"><b>${t.title}</b>${t.artist.name}</div><div style="color:var(--neon)">‚ñ∂</div>`;
            d.onclick = () => playFull(t.artist.name, t.title);
            resDiv.appendChild(d);
        });
    }

    async function playFull(artist, title) {
        const query = encodeURIComponent(`${artist} ${title}`);
        status.innerText = "üîç –°–ö–ê–ù–ò–†–£–ï–ú –°–ï–¢–¨ (YOUTUBE + SOUNDCLOUD)...";
        
        // –°–ø–∏—Å–æ–∫ ¬´–∂–∏–≤—ã—Ö¬ª —Å–µ—Ä–≤–µ—Ä–æ–≤-–∑–µ—Ä–∫–∞–ª YouTube
        const instances = [
            "https://invidious.v0l.it",
            "https://inv.tux.rs",
            "https://invidious.nerdvpn.de"
        ];

        let found = false;

        for (let base of instances) {
            if (found) break;
            try {
                // –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –≤–∏–¥–µ–æ –Ω–∞ YouTube —á–µ—Ä–µ–∑ –∑–µ—Ä–∫–∞–ª–æ
                const searchUrl = `${base}/api/v1/search?q=${query}&type=video`;
                const r = await fetch(PROXY + "?url=" + encodeURIComponent(searchUrl));
                const data = await r.json();
                
                if (data && data[0]) {
                    const id = data[0].videoId;
                    // –ü–æ–¥–∫–ª—é—á–∞–µ–º –ø–æ—Ç–æ–∫ (itag 140 = —Ç–æ–ª—å–∫–æ –∞—É–¥–∏–æ)
                    audio.src = `${base}/latest_version?id=${id}&itag=140`;
                    
                    await new Promise((resolve) => {
                        const t = setTimeout(() => resolve(), 4000);
                        audio.onloadedmetadata = () => {
                            if (audio.duration > 30) {
                                found = true;
                                status.innerHTML = `‚úÖ –ò–ì–†–ê–ï–¢ –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø: ${artist}`;
                                resolve();
                            }
                        };
                        audio.onerror = () => resolve();
                    });
                }
            } catch (e) { console.log("–ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –∑–µ—Ä–∫–∞–ª–æ..."); }
        }

        if (!found) {
            status.innerHTML = "‚ö†Ô∏è –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π MP3-–∫–∞–Ω–∞–ª...";
            audio.src = `https://musicapi.x0.at/play?q=${query}`;
        }
        
        audio.play().catch(() => {
            status.innerHTML = "<span style='color:red'>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É PLAY –≤ –ø–ª–µ–µ—Ä–µ</span>";
        });
    }
</script>
</body>
</html>
