<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Hub GOAT Edition</title>
    <style>
        :root { --neon: #00ff88; --dark: #080808; }
        body { background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .header { width: 100%; padding: 40px 0; background: #000; border-bottom: 2px solid var(--neon); text-align: center; }
        input { width: 85%; max-width: 500px; padding: 15px 25px; border-radius: 50px; border: 1px solid #333; background: #111; color: #fff; font-size: 18px; outline: none; }
        .results { width: 95%; max-width: 700px; margin-top: 20px; padding-bottom: 160px; }
        .track { display: flex; align-items: center; background: #121212; padding: 15px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; border: 1px solid #1a1a1a; }
        .track:hover { border-color: var(--neon); background: #1a1a1a; }
        .info { flex-grow: 1; margin-left: 15px; }
        .info b { display: block; color: var(--neon); font-size: 16px; }
        .player-bar { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); border-top: 2px solid var(--neon); padding: 20px; text-align: center; box-sizing: border-box; }
        #status { margin-bottom: 10px; font-size: 13px; color: var(--neon); font-weight: bold; }
        audio { width: 100%; max-width: 600px; filter: invert(1) hue-rotate(80deg); }
    </style>
</head>
<body>

<div class="header">
    <h1 style="letter-spacing: 5px; font-weight: 200; margin-bottom: 20px;">ULTIMATE PLAYER</h1>
    <input type="text" id="search" placeholder="–ò—â—É –≤–µ–∑–¥–µ: YT, VK, SC, MP3...">
</div>

<div class="results" id="res"></div>

<div class="player-bar">
    <div id="status">–ì–æ—Ç–æ–≤ –∫ –ø–æ–∏—Å–∫—É –ø–æ–ª–Ω—ã—Ö –≤–µ—Ä—Å–∏–π</div>
    <audio id="audio" controls autoplay></audio>
</div>

<script>
    // –í–°–¢–ê–í–¨ –°–í–û–Æ –°–°–´–õ–ö–£ –ò–ó GOOGLE SCRIPTS
    const PROXY = "https://script.google.com/macros/s/AKfycbw6de1PMwI3ybomuD9QSEHuTghYT4tm_xBKnTfYY1kECjNvTVNYDh6mVd623I8LnZECCQ/exec"; 

    const input = document.getElementById('search');
    const resDiv = document.getElementById('res');
    const audio = document.getElementById('audio');
    const status = document.getElementById('status');

    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') search(input.value);
    });

    async function search(q) {
        resDiv.innerHTML = "<p style='text-align:center'>–ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–∞–º...</p>";
        try {
            const searchUrl = `https://api.deezer.com/search?q=${encodeURIComponent(q)}`;
            const res = await fetch(PROXY + "?url=" + encodeURIComponent(searchUrl));
            const data = await res.json();
            render(data.data);
        } catch (err) { status.innerText = "–û—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏!"; }
    }

    function render(tracks) {
        resDiv.innerHTML = "";
        tracks.forEach(t => {
            const div = document.createElement('div');
            div.className = 'track';
            div.innerHTML = `<img src="${t.album.cover_small}" style="border-radius:5px"><div class="info"><b>${t.title}</b><span>${t.artist.name}</span></div>`;
            div.onclick = () => tryPlayFull(t.artist.name, t.title, t.preview);
            resDiv.appendChild(div);
        });
    }

    async function tryPlayFull(artist, title, preview) {
        const q = encodeURIComponent(`${artist} ${title}`);
        status.innerHTML = "üîç –ò—â–µ–º –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 5-10 —Å–µ–∫)...";
        
        // –°–ø–∏—Å–æ–∫ —Å–∞–º—ã—Ö –º–æ—â–Ω—ã—Ö —à–ª—é–∑–æ–≤
        const sources = [
            `https://api.vkmusic.me/search?q=${q}`,
            `https://musicapi.x0.at/play?q=${q}&engine=youtube`,
            `https://api-music.xyz/search?q=${q}`
        ];

        let success = false;

        for (let src of sources) {
            if (success) break;
            try {
                const streamUrl = PROXY + "?url=" + encodeURIComponent(src);
                audio.src = streamUrl;
                
                // –ñ–¥–µ–º –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
                await new Promise((resolve) => {
                    const t = setTimeout(() => resolve(), 6000);
                    audio.onloadedmetadata = () => {
                        if (audio.duration > 45) {
                            success = true;
                            status.innerHTML = "‚úÖ –ò–ì–†–ê–ï–¢ –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø";
                            resolve();
                        }
                    };
                    audio.onerror = () => resolve();
                });
            } catch (e) {}
        }

        if (!success) {
            status.innerHTML = "‚ö†Ô∏è –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤–∫–ª—é—á–∞—é –¥–µ–º–æ";
            audio.src = preview;
        }
        audio.play();
    }
</script>
</body>
</html>
